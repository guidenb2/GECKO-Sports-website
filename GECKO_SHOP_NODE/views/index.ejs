<html>
  <head>
    <title><%= title %></title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
  </head>

  <body>
    <h1><%= title %></h1>
    <p>Welcome to <%= title %></p>

    <table id="product-table">
      <thead>
        <tr>
          <td>Name</td>
          <td>Description</td>
          <td>Price</td>
        </tr>
      </thead>
    </table>

    <form id="login-form" method="POST" , action=".">
      <label for="username">Username</label>
      <input type="text" id="form-username" name="username" placeholder="Your username" />
      <label for="password">Password</label>
      <input type="password" id="form-password" name="password" placeholder="Your password" />
      <input type="submit" value="Submit" />
    </form>

    <script>
      fetch("http://localhost:8000/api/products/?format=json") // make a request
      .then(response => response.json()) // with our response, get the json data returned
      .then(data =>{
        console.log(data)
        data.forEach(element =>{
          let table = document.getElementById("product-table") // Fetch the table above
          let newRow = document.createElement("tr") // Add in a row <tr></tr>
          table.appendChild(newRow) // Add the new row to table

          let name = document.createElement("td") // Create <td>Inner html</td>
          name.innerHTML = element["name"]
          newRow.appendChild(name)

          let desc = document.createElement("td")
          desc.innerHTML = element["description"]
          newRow.appendChild(desc)

          let price = document.createElement("td")
          price.innerHTML = element["price"]
          newRow.appendChild(price)
        });
      }); // log the json data

      let login = document.getElementById("login-form")
      login.addEventListener("submit", (event) =>{
      event.preventDefault();

      let user = document.getElementById("form-username").value
      let password = document.getElementById("form-password").value

      fetch("http://localhost:8000/token/",
      {
            method: 'POST',
            headers:
            {
              'Accept': 'application/json',
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({username:user, password:password})
      }).then(response => response.json()).then(data => console.log(data))
    }, true)
    </script>

  </body>
</html>
